<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel - Video Rooms</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
      color: #333;
    }

    h1 {
      color: #1d557d;
    }

    #roomList {
      margin-top: 20px;
      padding: 0;
      list-style: none;
    }

    li {
      padding: 10px;
      background-color: #fff;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }

    button {
      padding: 10px 20px;
      background-color: red;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }

    #status {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>Admin Panel</h1>
  <button id="deleteRooms">Delete All Rooms</button>

  <ul id="roomList"></ul>
  <div id="status"></div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCRqfvB5bi8jmxNfu5zhVMcwWR0-YIM8ks",
      authDomain: "video-chat-44584.firebaseapp.com",
      projectId: "video-chat-44584",
      storageBucket: "video-chat-44584.appspot.com",
      messagingSenderId: "598757234224",
      appId: "1:598757234224:web:1ae7b1d35abafeb7d7bff5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const roomList = document.getElementById('roomList');
    const status = document.getElementById('status');
    const deleteButton = document.getElementById('deleteRooms');

    async function loadRooms() {
      roomList.innerHTML = '';
      const querySnapshot = await getDocs(collection(db, "rooms"));
      if (querySnapshot.empty) {
        roomList.innerHTML = '<li>No rooms available</li>';
        return;
      }

      querySnapshot.forEach((docSnap) => {
        const li = document.createElement('li');
        li.textContent = `Room ID: ${docSnap.id}`;
        roomList.appendChild(li);
      });
    }

    async function deleteAllRooms() {
      const querySnapshot = await getDocs(collection(db, "rooms"));
      let deletedCount = 0;
      for (const docSnap of querySnapshot.docs) {
        await deleteDoc(doc(db, "rooms", docSnap.id));
        deletedCount++;
      }
      status.textContent = `Deleted ${deletedCount} room(s) successfully.`;
      loadRooms();
    }

    deleteButton.addEventListener('click', () => {
      if (confirm("Are you sure you want to delete all rooms?")) {
        deleteAllRooms();
      }
    });

    loadRooms();
  </script>
</body>
</html>
